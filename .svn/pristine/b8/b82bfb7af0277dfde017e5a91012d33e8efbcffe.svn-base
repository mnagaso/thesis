\chapter{3D simulation of acoustic wave propagation with a realistic temperature field}

% title of chap 4 should be indicagte
% -3d
% cfd les

%\fromchristian{Peux-tu me confirmer que, en plus des calculs de propagation ultrasonore pour chaque carte de pas de temps, tu fais egalement un calcul de propagation pour la carte de temperature moyenne (equivalente a une carte RANS) obtenue en moyennant au point M les temperatures de toutes les cartes au point M ?
%%
%Il semble tres interessant de comparer l'effet des ERP et le champ de temperature moyen.
%J'ai deja prepare un code dedie au calcul de l'intensite de la fluctuation de la temperature.
%Donc en modifiant ceci, je vais egalement calculer la carte de temperature moyenne.
%%
%Il faut qu'on discute de ton calcul.
%Pour chaque pas de temps ti, on a une carte 3D de temperatures Ti, avec en M : Ti(M), Ti(M) variable en fonction de ti. On a Ti(M)=T\_R (M) + dTi(M), T\_R (M) etant une temperature ''moyenne'' sur l'ensemble des pas de temps, dTi(M) etant la fluctuation temporelle donnee par le calcul LES.
%%
%Il serait bien que la valeur moyenne T\_R calculee corresponde a celle qu'aurait donne un calcul ''RANS'' (est-ce vrai ?), cela permettait de voir l'apport du calcul LES par rapport au calcul RANS, et de voir l'erreur qu'on commettait en ajoutant par exemple au calcul RANS une fluctuation aleatoire gaussienne.}
%
\section{Objective of this study}

% what was done in the former section
In the former Chapter (Chapter \ref{chap:3}), we studied the wave propagation in liquid sodium with temperature heterogeneity (\autoref{sec:UPSILON}).
The heterogeneity of medium temperature was defined at first as a static medium (i.e. the temperature field is defined with a simple equation and the fluctuation caused by convection was not included).
Then next, we applied Gaussian Random Field (GRF) as a modeling method for fluctuation of medium temperature (\autoref{sec:2DGRF}).

% again the problem of the GRF
The GRF is confirmed as the representative method to describe medium heterogeneity \parencite{Fiorina1998Applicationofthe}, however it is for isotropic medium, i.e. GRF is not applicable for the medium with a flow velocity field as mentioned by \cite{Iooss2002Numericalsimulationof}.
This article also mentions that the two-dimensional fluctuation of temperature field may have weaker effect on a wave propagation than three-dimensional fluctuating field.
This is because in two-dimensional simulation, curvature factor of temperature boundary may have its effect on two-direction (i.e. x-z axis) but not for the other direction.
Namely the curvature for y axis is always $\infty$ under the two-dimensional approximated condition.

% What we want to study with the 3D simulation
In this chapter, we will carry out the three-dimensional numerical simulations with application of more realistic fluctuating wave propagation medium i.e. liquid sodium.
In the SFRs, the thermo-hydraulic situation is generated by the sodium jets with high temperature and surrounding sodium with lower temperature, and mixing phenomenon between them. 

As the modeling target of our study, we selected an experimental and numerical study called PLAJEST since it is also targeting the same object of the same condition i.e. the upper-core region of SFR in operation.
About the configuration of this experiment by JAEA and the numerical simulation by CEA/STMF are explain in \autoref{ssec:PLAJEST}.

% study about the mixing state of flow jets
Phenomenon of mixing flows has been actively studied e.g. \cite{Durve2012Numericalinvestigationof}, \cite{Zang2015Onthewake} and \cite{Ghahremanian2014Nearfieldmixing}.
They identified the mixing state of flows and categorized into 3 types by the state of mean velocity (Figure \ref{fig:mixing_state} A), i.e. converging region, merging region and combined flow region.

Converging region starts from the exit of flow and continues till the negative mean flow (i.e. flow goes inverse direction of jets) disappears.
The point where the negative flow disappears is so-called Merging point.
At this merging point, each flow still conserve its own flow and they are not united yet.

{\color{red}
From the merging point, those flows start to be gradually merged and finally the mean flow distribution becomes as one large flow.
This point is called combined point.

Durve also carried out comparative study on several models for predicting the mean temperature temperature field and temperature fluctuation field caused by mixing phenomenon of three jets \parencite{Durve2010Thermalstripingin}.
About the fluctuation intensity of temperature, this study shows the standard deviation curves of temperature with similar shape of ours (Figure 9 of \cite{Durve2010Thermalstripingin}).
This figure indicates root mean square curves divided by the temperature difference between hot and cold jet.
Multiple comparison among models are shown depending on the altitude (distance from the jets' outlets).
The transient of the shape of curves also seems identical to our analysis, that is, as our TFI curves, the curves shown in this study have two peaks at lower altitude then these two peaks start merging when the altitude goes higher the finally the peaks are merged completely.
However because of differences about geometry, temperature condition and so on, we do not compare our analysis of TFI with Durve's results.   
}


As a comparative criterion between thermo-hydraulic state and acoustic simulation results, we use an index so called Temperature Fluctuation Intensity (TFI). We use the definition of TFI as,

\begin{align}\label{eq:4_1}
    TFI(\boldsymbol{r})=\sqrt{\frac{1}{N}\sum_{i=1}^{N}(T(i,\boldsymbol{r})-\bar{T}(\boldsymbol{r}))^2}, r=(x,y,z)
\end{align}
where,
$\boldsymbol{r}$: spatial position vector,
$i$: time step number,
$N$: total number of time steps,
$T(i,\boldsymbol{r})$: an instant temperature value at time step $i$ and position $\boldsymbol{r}$ and
$\bar{T}(\boldsymbol{r}) = \frac{1}{N}\sum_{i=1}^N T(i,\boldsymbol{r})$: average temperature at $\boldsymbol{r}$.

Figure \ref{fig:mixing_state} B is the 2D cross-section at y = \SI{0.09}{\meter} of calculated 3D TFI field from CFD results of PLAJEST.
There are three jets in the configuration of PLAJEST (center position of jets are x = \SIlist{-0.070;0.0;0.070}{\meter}),
Between each jet, two zones with high TFI value arise by the interaction of those jet flows.

{\color{red}
From this TFI field, it is found that for the transient of TFI profile depending on the altitude, it seems to be possible to define 3 zone in similar way with the 3 zone for mean flow field explained above.
Here we would like to define a way to distinguish the state of flow mixing.
This is because from acoustic point of view, the element which have important effect is not the flow field but the temperature field and temperature fluctuating field \parencite{Massacret2014Modellingofultrasonic}.

At first, the two high TFI zones arise around z altitude = \SI{0.05}{\meter} and these two zones are completely separated.

Around z altitude = \SI{0.09}{\meter} or lower altitude, beginning of merging of the high TFI zones becomes clear (lowest TFI value between two peeks starts to grow).
Here there would be some specific point that we call as a merging point of TFI zone.

The merging of these two zone will be matured when the z altitude becomes higher, then around z altitude = \SI{0.19}{\meter} these two zones are completely merged (the peak of 1D TFI curve become only one)
We may call this altitude as a combining point of TFI zone.

In the following section, we will carry out more detailed analysis to verify the transient state of TFI profiles and verify the defininition these two point. 
When we analyse the results of acoustic simulation, these two altitudes will be referred to compare with the thermo-hydraulic state. 
}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=16.0cm]{mixing_state_v3.png}}
    \slantedcaption{A. Definitions of three mixing states (taken from \cite{Durve2012Numericalinvestigationof}). B. TFI field on 2D cross-section at y = \SI{0.09}{\meter} and 1D profiles. Point a, b, and c are the reference points used for 1D sequential analysis.}
    \label{fig:mixing_state}
\end{figure}

{\color{red}
Thus, the main objectives of this chapter are to:
\begin{itemize}
    \item see how an acoustic wave propagation fluctuation changes its manner depending on the state of mixing flows.
    \item Especially, from the point of transient of TFI 1D curves, which likely have the three zones of TFI field (converging, merging and combined region) remarked above, we will try to find how the difference of acoustic signals',
    \begin{itemize}
        \item fluctuation period of receiving time (time of flight) and maximum amplitude,
        \item if the distribution of fluctuation is normal (i.e. if axisymmetrical). 
    \end{itemize} 
\end{itemize}
}

\section{Definition of insonified volume}

Insonified volume is defined as a part of plajest volume as a purple box in Figure \ref{fig:plajest_geo}. 
% geo pla
In the geometry of PLAJEST, 3 sodium jets outflow from the gaps with \SI{20}{\milli\meter} width. The region for wave propagation simulation is extracted (purple box). Multiple simulations are carried out with changing the z coordinate of extracted region from \SI{40}{\milli\meter} to \SI{340}{\milli\meter} above the outlet at the intervals of \SI{10}{\milli\meter}.
The temperature pattern just above the outlets is simple and stable while it becomes more complex and unstable when z coordinate goes the farther.
The magnitude of fluctuation may be seen by TFI visualization in Figure \ref{fig:mixing_state} B.

Multiple insonified volume will be defined with same size of volume, same relative positions of acoustic source and signal observing surfaces and with different altitudes. 

In each insonified volume, a circular plane source is defined as Figure \ref{fig:plajest_src}.
The color shows the maximum amplitudes of the emissions at each point normalized by the maximum amplitude at the center of the circle. 
The plane source is composed of monopole point sources on a circular plane with a diameter of \SI{0.0254}{\meter} (i.e. 1 inch). 
The intervals of each point sources are same as the element size of SPECFEM mesh (i.e. approximately  meter). 
Each source point emits a 1MHz Ricker wavelet at the same time. 
The maximum amplitude of each emission is multiplied by hamming window function depending on the distance from the center of the circle.

Figure \ref{fig:plajest_rec_def} shows the definitions of observation surfaces of acoustic signals.
On each plane, the receiving points (where acoustic signals are recorded) are placed with \SI{0.0005}{\milli\meter} pitch.

Figure \ref{fig:plajest_receiver_plane_geo} shows the positional relation between the insonified volume (central z altitude = \SI{0.1}{\meter}) and the geometry of PLAJEST. 
The numbers in meter shows the distance from the source to each y-z receiver plane.

\begin{figure}[htbp]
    \centerline{\includegraphics[width=16.0cm]{plajest_geo_v2.png}}
    \slantedcaption{(a) Geometry of PLAJEST CFD simulation.  (b) A snapshot of CFD result at time \SI{200.0}{\second}, x-y cross-sectional plane at y = \SI{0.09}{\meter}. 
    Visualization for this image was done by VisIt, an open source visualization tool for massive scientific data \parencite{Childs2012VisItAnEnd}.}
    \label{fig:plajest_geo}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=10.0cm]{plajest_src.png}}
    \slantedcaption{The circular source plane applied for the simulations.}
    \label{fig:plajest_src}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=9.0cm]{plajest_rec_def.png}}
    \slantedcaption{The positions of the plane source (blue) and receiver surfaces (orange and red). The x position of the source plane is at x=\SI{-0.128}{\meter}.}
    \label{fig:plajest_rec_def}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=18.0cm]{plajest_receiver_plane_geo_v3.png}}
    \slantedcaption{Relation of positions between an insonified volume (central z altitude = \SI{0.1}{\meter}) and the geometry of PLAJEST. The Point A, B and C are positions of the reference points for temporal analysis.}
    \label{fig:plajest_receiver_plane_geo}
\end{figure}



\section{Mesh generation and Interpolation of temperature field from tetra4-element to hexa27-element}

CEA/STMF used a numerical code for CFD calculation called TrioCFD (known as Trio\_U by 2015) for this PLAJEST numerical simulation and LES was selected as the turbulent model.
% detail CFD calculation
Tetrahedral element with 4 nodes was selected for TrioCFD computation model. Total number of element reached \num{5582706} and characteristic mesh length was set to \SI{1.40}{\milli\meter}. Initial \SI{200}{\second} of their calculation was excluded from their computation result because the duration for stabilization of the flow state is required.
Thus, \numrange{200}{210}\si{\second} with \SI{0.1}{\milli\second} of time step is available as candidates for our wave simulation.
3 jets of sodium exist in this setup. Sodium with lower temperature (304.5\textdegree{}C) is emitted from central jet and with higher temperature (347.5\textdegree{}C) from two outer jets. The average flow velocity is \SI{0.51}{\meter\per\second} for every jet (Figure \ref{fig:plajest_jaea} B).
The simulated temperature field at time = \SI{200.000}{\second} is shown in Figure \ref{fig:plajest_cea} (C). Their simulation results achieved good accordance with the experiment results by JAEA in terms of normalized time-averaged temperature, normalized time-averaged temperature fluctuation Spectral power density and standard deviation of temperature values (Figure \ref{fig:plajest_cea} A, B and D).

For their calculation, tetrahedral unstructured staggered mesh was used.
Temperature field values are defined at the center of each TrioCFD's tetrahedral mesh elements and flow velocity values are defined on the vertex nodes.

In the following steps these values are transferred with interpolation onto each node of SEPCFEM3D hexahedral mesh using the simulation data management tool MEDCoupling. MEDCoupling is a part of total pre-/post-processing platform SALOME (\url{http://www.salome-platform.org/}) and also MEDCoupling is used independently as a library for being included in self-made C++ or Python code. We made a codes-scripts set to be done the preprocessing for PLAJEST3D-SPECFEM3D simulation almost automatically. Figure \ref{fig:temp_field_interpolation_processs} shows the temperature field data transfer and mesh generation steps as a pre-process for SPECFEM3D simulation.

At first, hexahedral element mesh for SPECFEM3D is built by the meshing software CUBIT (developed by Sandia National Laboratories, U.S.). Figure \ref{fig:interp_examp} indicates some examples of this step. Thanks to accessible Python scripting option, it is possible to select arbitrary volume to be extracted from entire geometry and meshing is completed automatically including assignment of material characteristics and absorbing surface flags (fluctuation of temperature field may be re-defined after.) In this step, the region for a wave simulation is specified in order to eliminate acoustically uninterested part from entire PLAJEST geometry and reduce the required amount of computer memory which is possibly become one of limitations of wave simulations.
% conversion of CUBIT model to SPECFEM Model
After the CUBIT model generation, it is necessary to convert the mesh type from first/second order hexahedral finite element exported (exported by CUBIT) to spectral element for SPECFEM3D. 
In this conversion step, Gauss-Lobatto-Legendre points are inserted in each first/second order hexahedral finite element.
In order to speed-up this conversion process, we used IOSS (IO Systems) library included the FE analysis supporting software SEACAS (also developed by Sandia National Laboratories, United States).

After finishing preparation of mesh data, we carried out the temperature field transfer, i.e. interpolation of temperature values defined on the middle points of each tetrahedral finite element to corner nodes of hexahedral finite element.
The CFD result calculated by TrioCFD is stored in Lata binary format having 1 temporal and 3 spatial dimensions for node coordinates and temperature and flow velocity field data.
This flow velocity data is not used for our simulation because we apply the frozen fluid hypothesis from the result of former study \parencite{Massacret2012Simplifiedmodelingof}. 
This hypothesis is explained in \autoref{ssec:fluc_mod}.
Lata format is a type of binary data format, which has been developed by CEA to allow to treat massive time-sequential volume data with high speed \parencite{Childs2012VisItAnEnd}. 
Mesh information, which is a combination list of node indices composing each element, is also included this Lata data. For conversion of this Lata binary to our necessary information (i.e. node coordinates, mesh, and field data.) in ASCII, I generated a small code in C++ referring visIt source code. VisIt (\url{https://wci.llnl.gov/simulation/computer-codes/visit}) is an open source visualization software for numerical simulations, developed by Lawrence Livemore National Laboratory in U.S. Converted CFD data are also loaded into the temperature field transfer code. When loading, only the necessary size and part of region is loaded in order to reduce the memory size requirement.

Then conversion of the temperature field from TrioCFD tetrahedral mesh to SPECFEM3D nodes is done by using MEDCoupling function. 
Because the mesh to node transfer does not support HEXA27 (second order hexahedral finite element) element, if the interpolation-target mesh is HEXA27, then HEXA27 needs be manually split to 8 parts of HEXA8 (first order hexahedral finite element) elements in this process.



Determination of an element size is done following 2 conditions, which are CFL condition (Equation \ref{eq:4_810}) and the number of
elements par one wave length,
\begin{align}\label{eq:4_810}
    C_p\frac{\Delta t}{\Delta x_{gll}} \leq \alpha
\end{align}
where $\Delta t$ is the interval of each time increment, $\Delta x_{gll}$ is the minimum interval of GLL points.
We selected the averaged Courant number $\alpha$ = \num{0.4} and the wave celerity $C_p$ = \SI{2416.268}{\meter\per\second}(in sodium with lowest
temperature value \num{274.5} \textdegree{}C during the CFD simulation) for the calculation of a mesh size and time step length.
In the equation \ref{eq:4_810}, $\Delta x_{gll}$ is not the mesh size itself, but it is the interval of GLLpoints. 

We decided the mesh size $\Delta x$ = \SI{8.05d-4}{\meter}, time step interval = \SI{2.3d-8}{\second}. For the
number of time step updates, we set 5000 steps for having enough temporal duration for waves' passing through entire
simulation domain. The mesh model used our simulations has \num{3250000} elements and \num{3722406} nodes, and total number of
computation nodes including GLL points became \num{215320764}.

\begin{figure}[htbp]
    \centerline{\includegraphics[width=14.0cm]{temp_field_interpolation_processs_v4.png}}
    \slantedcaption{Explanation of data processing for mesh generation and preparation of heterogeneous medium for acoustic calculations.}
    \label{fig:temp_field_interpolation_processs}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=14.0cm]{interp_examp_v2.png}}
    \slantedcaption{Examples of some interpolations of temperature fields from tetrahedral element to hexahedral element by MEDCoupling (pre/post processing library). Temperature field on tetrahedral elements are indicated with transparent color on the interpolated field on hexahedral mesh.}
    \label{fig:interp_examp}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=10.0cm]{real_temp_field_sample.png}}
    \slantedcaption{One of the heterogeneous temperature fields used for the 3D wave propagation calculations. This field is taken from timestep=10, central altitude of the calculation domain is \SI{0.1}{\meter} from sodium outlet.
    One mesh model includes 3,250,000 elements and 3,722,406 nodes and total number of computation nodes including Gauss-Lobatto-Legendre points became 215,320,764.}
    \label{fig:real_temp_field_sample}
\end{figure}


\section{Results of acoustic wave propagation in a single temperature field}

In this part, we check the ultrasound sensitivity to thermo-hydraulic changes.
This is to study how the ultrasonic beam is deflected or deformed by the temperature field.
In the following section, we will study the evolution of measurements as a function of time.

\begin{figure}[htbp]
    \centerline{\includegraphics[width=16.0cm]{3dwavefronts.png}}
    \slantedcaption{Visualization of 3D wave front by contour (and clipped) at x position = A) \SI{0.105}{\meter} and B) \SI{-0.035}{\meter} calculated at z altitude = \SI{0.14}{\meter}, time = \SI{200.010}{\second} of PLAJEST under heterogeneous medium temperature condition.}
    \label{fig:3dwavefronts}
\end{figure}:want

Figure \ref{fig:3dwavefronts} is the visualized 3D wave fronts with 3D contour. 
In order to show the inside composition of wave-front, some images are clipped off of its half or quarter volume. 
The Red part has higher pressure values and blue part has lower.
These waves are calculated at time position of CFD = \SI{200.010}{\second} and z altitude = \SI{0.14}{\meter}.
The visual information reveals that the wave-front having passed through heterogeneous liquid sodium are actually deflected/deformed while the amount of wave deformation is not so large.
We will carry out the quantitative analysis on the amount of this modification in the latter part of this chapter. 

Figure \ref{fig:plajest_rec_def} and \ref{fig:plajest_receiver_plane_geo} show the positions of the plane source (blue) and receiver surfaces (orange and red). For the visualization purpose, acoustic fields calculated here are indicated as cross-section surfaces. The acoustic fields and the effects from temperature heterogeneity were observed for each simulation on x-y, y-z receiver planes and y-z receiver planes positioned at x = \SIlist{-0.105; -0.080; -0.035; 0.000; 0.035; 0.080; 0.105}{\meter}. The y-z plane at x = \SI{0.000}{\meter} is the middle point of the simulation domain. The others are placed at front and back of each sodium jet.

Figure \ref{fig:plajest_res1} shows part of acoustic fields obtained from all of the simulations. Here an acoustic field refers the maximum pressure values at each spatial point. In figure \ref{fig:plajest_res1}, acoustic fields on x-y, y-z and y-z plane (only x = \SIlist{0.035; 0.105}{\meter}) are indicated for the simulations whose middle z coordinate value of simulation domains are z = \SIlist{0.04; 0.12; 0.24; 0.34}{\meter}. Additionally, the top row is the results of the case with homogeneous medium. In the homogeneous case, the temperature of medium was set as 333.167\textdegree{}C which is the ambient temperature value of CFD calculations. 

From this figure, it is found that the acoustic field of z=\SI{0.040}{\meter}, which is close to the outlets, and homogeneous case are quite similar. It is because that the temperature boundary at just above the outlets is almost orthogonal to the direction of wave propagation. Also at z = \SI{0.340}{\meter}, the mixing of the hot and cold jets matured enough and the magnitude of temperature difference becomes small; therefore, a wave is less effected by the heterogeneity of this altitude. However, at z = \SIlist{0.120; 0.240}{\meter}, it can be seen that the acoustic fields are bent by heterogeneity and the loss of maximum amplitude values towards propagation distance becomes greater. This first qualitative description is then shown in \ref{fig:plajest_res2} with 1D profiles of the acoustic field.

In Figure \ref{fig:plajest_res2}, values of acoustic fields on z axis of each y-z receiver planes are indicated. 
Red lines represent the results of homogeneous cases and blue lines represent all of the results from heterogeneous cases at each z position of simulation domains. Amplitude values are normalized by the maximum amplitude (i.e. pressure) among all simulations.

How the maximum amplitude of pressure recorded on each y-z receiver plane changes depending the positional changes for z direction of simulation domains is indicated in Figure \ref{fig:plajest_res3}. 
At planes x = \SIlist{-0.105; -0.080}{\meter}, positioning near to the plane source, maximum amplitudes take approximately constant values regardless of distances from outlets. 
In contrast, at the farthest and second farthest y-z planes at x = \SIlist{0.105; 0.080}{\meter}, it was found that the amplitude value of simulation domain z = \SI{0.120}{\meter} is approximately 10 \% smaller than the other values. At the same time the second peak may be recognized at z = \SI{0.240}{\meter}.

It is considered that the effect of temperature heterogeneity becomes stronger under 2 conditions, that are:
\begin{itemize}
\item Mixing of hot and cold flow are grown enough so that the shape of temperature boundary is curved and not parallel to the emitted wave front.
\item Temperature difference is kept large.
\end{itemize}
At the altitude z = \SI{0.120}{\meter}, it is about the distance from outlets where the temperature boundary starts to be changed while the temperature difference is relatively still high compared to the region above.

On the other hand, it seems that, at z = \SI{0.240}{\meter}, the temperature difference there is already small and even smaller that z = \SI{0.230}{\meter}. This might be caused by the temperature boundary shape became a key factor of the total effects rather than the temperature difference.


% conclusion
This study observed the effects of three-dimensional heterogeneity of temperature field on a wave propagation under a high temperature liquid sodium environment by numerical simulation using spectral element method.

The heterogeneous temperature field were imported from CFD Large-eddy simulation which was carried out based on an experiment and validated its result by comparing with the experimental result.

As a result, it was found that there is a certain relationship between a strength of effects of temperature heterogeneity on acoustic fields and a distance from the outlets of sodium jets, i.e. the state of mixing flows. More concretely, the amount of effects on maximum acoustic pressure can vary up to about 10 \% at a certain altitude.

Accordingly, we may assume that the magnitude of temperature difference in a medium and the shape of temperature boundary are the key factor which decide the effect of medium heterogeneity on a wave propagation.

One single time step was examined for this study. In the next \autoref{sec:res_multi_time}, we will continue the simulation with the same configuration (i.e. configuration Plajest) for other time steps of CFD calculation in order to search for a relation between the strength of effects from medium heterogeneity and the variations of the ultrasonic signals.

%Subsequently, by comparing with a wave propagation with a heterogeneity generated by GRF, we will verify the availability of isotropic and anisotropic assumption on heterogeneity which was taken in GRF for the medium where a sodium flow exists.


\begin{figure}[htbp]
    \centerline{\includegraphics[width=16.0cm]{plajest_res1.png}}
    \slantedcaption{Acoustic fields obtained from all of the simulations.}
    \label{fig:plajest_res1}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=12.0cm]{plajest_res2_v2.png}}
    \slantedcaption{Values of acoustic fields on z axis at (y = 0) of each y-z receiver planes are shown.}
    \label{fig:plajest_res2}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=10.0cm]{plajest_res3_v2.png}}
    \slantedcaption{The maximum amplitude of pressure recorded on each y-z receiver plane changes depending the positional changes for z direction of simulation domains.}
    \label{fig:plajest_res3}
\end{figure}

\section{Analysis of temporal varying temperature fields of PLAJEST} \label{sec:res_multi_time}
\subsection{Selection of cfd time steps}
    Figure \ref{fig:timestep_extraction}
    % explanation on cfd
    The CFD calculation result carried out by CEA STMF has approximately \SI{10}{\second} in total from \SI{200.000}{\second} to \SI{210.197} with \SI{0.001}{\second} of interval. The initial \SI{200}{\second} of the calculation was dedicated for ensuring stabilization of the calculation.
    % how we selected?
    Because of the limitation of allocated computation time on the super-computer, it was not possible to run the temperature field interpolation and wave propagation calculation processes for all of the CFD time-steps.
    Instead, we extracted several time-steps of temperature field with wider interval from CFD results.

    In order to decide the time step interval for our acoustic simulation, we referred to the power spectrum density curve \parencite{Angeli2015LargeEddySimulation} (Figure \ref{fig:PSD_angeli}, blue line). This curve indicates the temperature history at x = \SI{-0.015}{\meter} (between the left and center jet), y = \SI{0.09}{\meter} (middle point on y axis) and z = \SI{0.1}{\meter}.
    From this curve, its peak is found lower than \SI{5}{\hertz}.
    Thus to be sure to include frequency of this \SI{5}{\hertz} of temperature fluctuation, we extracted the temperature fields with \SI{0.1}{\second} interval (\SI{10}{\hertz}).
    It is the extreme limit of Shannon's rule.
    Figure \ref{fig:timestep_extraction} shows this relation between CFD time steps and extracted time-steps for the acoustic simulations.

    Figure \ref{fig:psd_finer} shows the temperature histories and PSD curves of original CFD results at selected 3 points, and Figure \ref{fig:psd_coarser} shows the same kind of curves but with only extracted time steps.
    Those 3 points has the same y, z position (y = \SI{0.09}{\meter} and z = \SI{0.1}{\meter}) and different x position (x = \SIlist{-0.035;0.0;0.035}{\meter}).
    x = \SIlist{-0.035;0.035}{\meter} are the position between two jets and where the TFI will be higher than the other area.
    x = \SI{0.0}{\meter} is in the middle of the central jet.
    These three points were selected as examine thermo-hydraulics regime in three characteristic area.
    The positional relation with the PLAJEST geometry is indicated as Point A,B,C in Figure \ref{fig:plajest_receiver_plane_geo} and relation with TFI is indicated as Point a,b,c in Figure \ref{fig:mixing_state}.

    Using all time steps of CFD results, we calculated PSD curves (Figure \ref{fig:psd_finer}). 
    The peak of PSD curve is confirmed at \SI{3}{\hertz} and lower for any higher frequency. 
    Then PSD curves calculated from coarser time step which identical to time steps for acoustic simulation show that the peak frequency at \SI{3}{\hertz} is still conserved for the central point.
    From this comparison, we could verify that the peak frequency of temporal temperature fluctuation is remaining lower than the frequency limit which we designed for our acoustic simulation.
    %Spatial resolution of temperature fluctuation is not decreased by this time step extraction.

    {\color{red} We decided this frequency limit considered for our calculation before carrying out the temperature history analysis.
    This limit was designed for our initial guess that fluctuation peak of temperature is around \SI{2}{\hertz} which is actually \SI{3}{\hertz}.
    Thus we are still not sure if the time step gaps between time step extraction for our acoustic simulation.
    We are planning to new calculations with refined time steps.}



\begin{figure}[htbp]
    \centerline{\includegraphics[width=10.0cm]{PSD_angeli.png}}
    \slantedcaption{Normalized PSD curves of temperature history of CFD calculation (Blue line) at x = \SI{-0.015}{\meter}, y = \SI{0.09}{\meter} and z = \SI{0.1}{\meter} taken from \cite{Angeli2015LargeEddySimulation}. Normalized PSD curves are calculated from dividing original PSD by the maximum PSD value.}
    \label{fig:PSD_angeli}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=8.0cm]{timestep_extraction.png}}
    \slantedcaption{Sampling intervals for CFD simulation and wave propagation simulation.}
    \label{fig:timestep_extraction}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=16.0cm]{psd_finer_v2.png}}
    \slantedcaption{A. PSD curves and B. tmperature histories of CFD results at 3 different x positions (y = \SI{0.09}{\meter}; z = \SI{0.1}{\meter}) with 10 k Hz sampling.}
    \label{fig:psd_finer}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=16.0cm]{psd_coarser_v2.png}}
    \slantedcaption{A. PSD curves and B. temperature histories and of extracted time steps at 3 different x positions with 10 Hz sampling.}
    \label{fig:psd_coarser}
\end{figure}

\subsection{Treatment of massive amount of caluculation and management of results}
    In this study, all of simulations were performed on 2 supercomputers, CURIE (CEA TGCC) and OCCIGEN (CINES).
    By the helps of those advanced computer systems and gigantic capacities dedicated for scientific calculations, the computation domain was divided into 256 parts then the parallelized calculations were carried out. 
    The average duration for 1 acoustic simulation takes about 26 minutes excluding mesh generation and interpolation processes of temperature fields.

    The duration for the interpolation of temperature field from a TrioCFD result to SPECFEM3D is approximately 20 hours using single CPU for one acoustic simualtion altitude of one time step.
    For acoustic simulation itself, one simulation (for one altitude of one time step) takes about 26 minutes using 256 CPUs.

    We carried out 70 time steps of interpolation of 3D temperature field and 70 time steps x 22 altitude = 1540 acoustic simulations.

    Because of numbers of caluculations, the result data cannot be conserved as 3D volume data because of limitation of allocated storage on supercomputers.
    In stead of storing all result data in 3D, at first we selected the 2D planes where the acoustic signals will be observed (Figure \ref{fig:plajest_rec_def}).
    Then then we defined the time windows for each y-z planes to cut received signals depending on the arrival time of wave front.
    By this limitation, we could avoid storing the time signal before arrival of waves and after the waves passed completely.
    This limitation of time window was possible because we only simulated pure acoustic region.
    Thus any multi-reflection may not be occurred.

    The limited acoustic signals recorded at the point receivers are gathered and composed as one HDF5 binary format based on each receiver plane of each acoustic simulation.
    HDF5 (Hierarchical Data Format) format is one type of binary file formats which has been developed to manage extremely large and complex data collections.
    
    By using HDF5 format, we may access the result data faster than other file format e.g. ASCII, json, csv, pickle (python frendly binary data format) e.t.c.

\subsection{Processes for TFI data for comparison with Acoustic Simulation results}
    As is introduced at \ref{eq:4_1}, we use an index so called Temperature Fluctuation Intensity (TFI) as used in \cite{Angeli2015LargeEddySimulation}.

    Because of the great numbers of total time steps and also the computation nodes included CFD calculation result, the way to calculate TFI value by this equation as it is is not very efficient.
    To calculate TFI, we used the online algorithm described in this section.
    Figure \ref{fig:tfi3d} is the calculated TFI field in 3D and \ref{fig:mixing_state} B is the cross-section at y = \SI{0.09}{\meter}. We may find that there are two areas where TFI value become high between sodium jets at z (altitude) \SIrange{0.08}{0.16}{\meter}.
    It should be also noted that the TFI field is not symmetric with respect to the x center.

\begin{figure}[htbp]
    \centerline{\includegraphics[width=10.0cm]{tfi3d_v2.png}}
    \slantedcaption{Visualized 3D TFI field.}
    \label{fig:tfi3d}
\end{figure}

    The online algorithm is a type of algorithms which calculates some field value from serial data by one single step sequentially \parencite{Knuth1997TheArtof}.
    This algorithm is required for the serial data which each step needs great amount of the memory to be retained and/or the the number of serial data is significantly long to do entire loop calculation more than twice.
    For instance, we applied this online algorithm for calculation of TFI, i.e. standard deviation of temperature value at a given point.
    It is because standard deviation needs loop calculation for entire time steps, at first for calculation of mean temperature and secondly for calculation of difference between a temporal value and mean value.
    PLAJEST CFD data includes 10,000 time steps of 3D Volume data with 2,039,769 elements. 
    One entire loop calculation for this data takes about 10 hours.
    By applying the online algorithm for calculation of TFI, we can only need to do this long loop calculation one time.

    General definition of standard deviation of temperature at given position $\boldsymbol{r}$ is,
    \begin{align}\label{eq:4_2}
        \sigma^2 (\boldsymbol{r}) = \frac{1}{N}\sum_{i=1}^{N} (T(\boldsymbol{r},i) - \bar{T}(\boldsymbol{r}))^2
    \end{align}

    where, $N$ is the number of total time steps and $\bar{T}(\boldsymbol{r})=\frac{1}{N}\sum_{i=1}^{N}T(\boldsymbol{r},i)$ is the average temperature at the position $\boldsymbol{r}$.

    On the online algorithm, the averaged value $\bar{T}(\boldsymbol{r},n)$ and the term $\sum_{i=1}^{n} (T(\boldsymbol{r},i) - \bar{T}(\boldsymbol{r}))^2 = M_{\boldsymbol{r},n}$
    are sequentially updated for each time step during the entire loop calculation.

    For each time step at $n$,
    \begin{align}\label{eq:4_3}
        \bar{T}_{\boldsymbol{r},n} = \bar{T}_{\boldsymbol{r},n-1} + \frac{T_{\boldsymbol{r},n} - \bar{T}_{\boldsymbol{r},n-1}}{n}
    \end{align}
    \begin{align}\label{eq:4_4}
       M_{\boldsymbol{r},n}=M_{\boldsymbol{r},n-1}+ (T_{\boldsymbol{r},n} - \bar{T}_{\boldsymbol{r},n-1})(T_{\boldsymbol{r},n} - \bar{T}_{\boldsymbol{r},n})
    \end{align} 

    At last the standard deviation calculation is finalizes as,
    \begin{align}\label{eq:4_5}
        \sigma_{\boldsymbol{r}}=\sqrt{\frac{M_{\boldsymbol{r},N}}{N}}
    \end{align}

    \begin{figure}[htbp]
        \centerline{\includegraphics[width=10.0cm]{tfi_1d_v2.png}}
        \slantedcaption{TFI values on x axis of y = \SI{0.09}{\meter} at several altitudes.}
        \label{fig:tfi_1d}
    \end{figure}

    \begin{figure}[htbp]
        \centerline{\includegraphics[width=10.0cm]{tfi_with_field.png}}
        \slantedcaption{TFI curves corresponding to the 2D TFI field. The left side of curve line position on z altitude accords to the z altitude where those lines are extracted.}
        \label{fig:tfi_with_field}
    \end{figure}

    Figure \ref{fig:tfi_1d} shows the TFI values on x axis of y = \SI{0.09}{\meter} at several altitudes (i.e. z positions) and Figure \ref{fig:mixing_state} B is those TFI curves drawn on the corresponding to the 2D TFI field.
    Maximum TFI value is found at around z altitude = \SI{0.13}{\meter}. Also the change of shape of the curves depending on the distance from the jets' exit seems to matche with the result of \cite{Durve2010Thermalstripingin},
    i.e. the curves at low altitude has two TFI peaks then those peaks will be gradually merged when the z altitude goes higher.
    We will complete these analysis in nest sections of this chapter.

\subsection{Calculate "Cumulated TFI" (CTFI) value}
    TFI calculated above is the index which evaluate the intensity of fluctuation at one spatial point, while an acoustic wave propagation will be affected not only by one position but by the whole state of points along its propagation. 
    Thus in order to find the appropriate thermo-hydraulic index for comparison with propagation wave, we defined cumulated TFI (CTFI) as below.
    CTFI is the value which indicates the amount of TFI that the acoustic wave experiences along the central axis.
    We define CTFI at the position $x_p$ on the propagation direction by the equation,
    \begin{align}\label{eq:4_6}
        {I_c}(x_p,z_{alt},R) = \int_{x_{s}}^{x_{p}} \int_0^R \int_0^{2\pi} I(r,\theta,z_{alt}) w(r) d\theta dr dx
    \end{align}

    where,
    $I_c$: CTFI value,
    $I(x,r,\theta)$: TFI value at $x,r,\theta$,
    $x_s$: the x coordinate of acoustic source,
    $z_{alt}$: the altitude (on z axis) of the center of acoustic source plane,
    $R$: distance from the central axis, considered as the TFI may have effect on an acoustic propagation and
    $w(r)$: weight function for making TFI values at near the central axis more effective and TFIs at far from the central axis less effective.

\begin{enumerate}
\item CTFI on 1D (integrate on central x axis)\\
    - with always $w(r) = 1$ and $R = $ one mesh size.
\item CTFI on 3D A (integrate in a domain where the acoustic beam passes)\\
    - with always $w(r) = 1$ and $R = $ the radius of acoustic source, i.e. 1.27 cm.
\item CTFI on 3D B (integrate in cylindrical volume where the acoustic beam passes with a weighting function)\\
    - with $w(r) = 0.54 + 0.46 cos{\pi \frac{r}{R}}$ and $R = $ the radius of acoustic source, i.e. 1.27 cm.
\end{enumerate}

The further $w(r)$ allows to take into account the whole ultrasonic beam. It is an approximation of the whole beam diverges.

In this thesis, we only use the first definition of CTFI i.e. CTFI on 1D as the first analysis.
The other definitions may be examined as a future work.

% ctfi
Figure \ref{fig:ctfi_1d} indicates the CTFI curves on x axis at y = \SI{0.09}{\meter} and several z altitude positions calculated by the first definition of CTFI.
The left image shows the CTFI depending on x position, i.e. propagation distance. The source plane is positioned at x = \SI{-0.128}{\meter}.
Each line means the z altitude position where the curves are extracted.
The magnitude of CTFI becomes largest around the z altitude = \SI{0.03}{\meter}.
The curves of lower z altitude show two-step increment as there are two peaks of TFI as we saw in the last subsection.
At higher than \SI{0.16}{\meter} position, this two-step increment is no longer seen.

The right image is CTFI values versus z altitude.
Each line means the x position, i.e. propagation distance (acoustic source is placed at x = \SI{-0.128}{\meter}).
The farther the x position becomes, the larger the magnitude of CTFI becomes as well.
We may find that the peak of the CTFI positions around \SIrange{0.13}{0.15}{\meter}.
For the x position = \SI{0.0}{\meter} where just after the first (left side of) high TFI zone and middle of central jet, the CTFI peak is slightly shifted to higher z altitude position.
This was caused by the slight difference of the shape/position of high TFI zones as one can see on Figure \ref{fig:ctfi_with_field}.

Figure \ref{fig:ctfi_2nd} shows the second derivatives of CTFI curves. The inflection points are found around x = \SI{0.09}{\meter} and \SI{0.19}{\meter}.
These points are the same altitudes that we defined as Merging point and Combining point of TFI.
%%% kono bunshou wo motto kyouchou suru


\begin{figure}[htbp]
    \centerline{\includegraphics[width=16.0cm]{ctfi_1d_v4.png}}
    \slantedcaption{CTFI curves on x axis at y = \SI{0.09}{\meter} and several z altitude positions}
    \label{fig:ctfi_1d}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=10.0cm]{ctfi_with_field.png}}
    \slantedcaption{CTFI curves corresponding to the 2D TFI field. The left side of curve line position on z altitude accords to the z altitude where those lines are extracted.}
    \label{fig:ctfi_with_field}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=10.0cm]{cfti_2nd_v2.png}}
    \slantedcaption{2nd order derivatives of CTFI 1D profiles. Each line means x position.}
    \label{fig:ctfi_2nd}
\end{figure}

\section{Comparison with acoustic simulation results}
\subsection{Fluctuation of acoustic signals}

    At first, we investigated the transition of the deviated wave front at the farthest y-z receiving plane (i.e. x = \SI{0.105}{\meter} and distance from the source = \SI{0.233}{\meter}).
    In Figure \ref{fig:move_impact_points} shows the scatter plot of impact points (i.e. the position where the pressure value become maximum on the y-z receiving plane.).
    In order to indicate the time transition of the impact point, arrows in red color is added with digits which show the order of the move of points.
    Histograms for y and z axis direction are also placed with the mean and standard deviation values.

    We confirmed that the standard deviation is augmented when the z altitude becomes higher, then the standard deviation becomes greatest at the z altitude = \SI{0.13}{\meter} (3 of \ref{fig:move_impact_points}).
    This shows good accordance with the peak z position of CTFI in Figure \ref{fig:ctfi_1d}.
    Also at the lower z altitude = \SIlist{0.04;0.09}{\meter}, the distribution of the impact point has directivity, i.e. the standard deviation for y-axis direction is larger than for z-axis direction.
    This result showed the fact that the 3D temperature fluctuation pattern before maturing of mixing state has directivity.
    Namely the approximation of fluctuation of acoustic celerity field with isotropic Gaussian random process may not be very accurate for the regions where the jets keep their flows.
    From this result, we could confirm the mention by \cite{Iooss2002Numericalsimulationof} about the in-applicability of isotropic Gaussian random field for this region in a quantitative way.
    A part of this directive effect may be caused by the geometry of PLAJEST, which has same cross-sectional shape on y axis.
    However in real geometry of SFR e.g. ASTRID, which has outlet tubes with larger diameter (\SI{0.15}{\meter}) than PLAJEST experiment (\SI{0.02}{\meter}), the same effect may be occurred depending on the directions of acoustic beam towards sodium jets even if the shape of jets are cylindrical.

\begin{figure}[htbp]
    \centerline{\includegraphics[width=16.0cm]{move_impact_points_v2.png}}
    \slantedcaption{Movement of acoustic impact point (i.e. the position where acoustic pressure become the largest) on y-z recieving plane at x = \SI{0.105}{\meter}, and histograms for y and z direction. Movements of only initial 7 time steps are indicated with red arrows and digits in magenta.}
    \label{fig:move_impact_points}
\end{figure}

    The acoustic fluctuation analysis was also carried out.
    Figure \ref{fig:acoust_sig_1d_fluc} shows the history of maximum amplitude and the time when the maximum amplitude received, and those normalized PSD curves.
    Maximum amplitude value are taken from the envelope of each received signal.
    Instead of using general definition of time of flight, we here defines the receiving time as when the magnitude of envelope of a receiving signal becomes maximum.
    The figures on the left column are the history of maximum amplitude value (in blue) and receiving times (in red).
    The figures on the right column are the PSD curves.
    The results received at 4 positions, at x = \SI{0.105}{\meter}, y = \SI{0.09}{\meter} and z = \SIlist{0.04;0.09;0.14;0.21}{\meter} are indicated.

    At the lowest z altitude (z = \SI{0.04}{\meter}), the magnitude of deviation of the signal is smallest among the 4 positions.
    At the higher z altitude (z = \SI{0.21}{\meter}), the magnitude of deviation becomes again smaller than at z = \SI{0.09}{\meter} and \SI{0.14}{\meter}.
    When it is compared with the CFTI values (In Figure \ref{fig:ctfi_1d}, CTFI value at z = \SI{0.09}{\meter} is lower than the value of z = \SI{0.14}{\meter}), while the standard deviation of both z altitude is almost same.
    
    This means that the in immatured flow mixing zone, the effect of medium fluctuation on a wave propagation need to be estimated more significantly than the more matured zone of flows.
    At this immatured flow mixing zone, the gradient of temperature is still large.
    For this reason, the amount of fluctuation of acoustic signal may be larger than the estimated value from CFTI curve.

    From the PSD at z altitude = \SI{0.04}{\meter}, the peak of both amplitude and receiving time place before \SI{1}{\hertz}.
    When the altitude becomes higher, only the peak of receiving time becomes to be \SI{3}{\hertz}, which also the peak frequency of temperature fluctuation as seen in Figure \ref{fig:psd_finer}.
    However the peak maximum amplitude still remain below \SI{1}{\hertz} even at z altitude = \SI{0.04}{\meter}.

\begin{figure}[htbp]
    \centerline{\includegraphics[width=16.0cm]{acoust_sic_1d_fluc.png}}
    \slantedcaption{History of maximum amplitude (in blue) and the arriving time (in red), and those normalized PSD curves.
    The results received at 4 positions, at x = \SI{0.105}{\meter}, y = \SI{0.09}{\meter} and z = \SIlist{0.04;0.09;0.14;0.21}{\meter}.}
    \label{fig:acoust_sig_1d_fluc}
\end{figure}

\subsection{Standard deviation analysis}
    In order to get new information that will help to interpret the fluctuation of the acoustic signals,
    we also carried out the standard deviation and mean values analysis for whole z altitudes based on the following 4 acoustic information,
    \begin{itemize}
        \item maximum amplitude at impact point and the center of y-z plane.
        \item the amount of deviation r.
        \item angle of impact point $\theta$.
        \item receiving time of maximum amplitude at the center of y-z plane.
    \end{itemize}
    Figure \ref{fig:impactpoint} shows the definitions of impact point, r and $\theta$.

    \begin{figure}[htbp]
        \centerline{\includegraphics[width=8.0cm]{impactpoint_v4.png}}
        \slantedcaption{Definitions of impact point, the amount of deviation $r$ and deviation angle $\theta$.}
        \label{fig:impactpoint}
    \end{figure}

    Figure \ref{fig:std_amps} shows the standard deviation and mean values of maximum amplitude values recorded at center and impact point of each y-z planes.
    1. shows the standard deviation and mean value of maximum amplitudes at the center of y-z planes of each z altitude.
    2. also shows the same values but recorded on the impact points.
    Each line is the mean value, and the error bar is the standard deviation at each position.
    The scale of value on the vertical axis is same for the mean values and the length of error bars as well.
    Mean values of maximum amplitude of each x position are not very different among the z altitudes.

    In 3., only the mean values of maximum amplitude are plotted (solid line: y-z center, break line: impact point).
    At the x positions far from the acoustic source (x = \SIlist{0.035;0.08;0.105}{\meter}), the differences of means between y-z center and impact point are regarded.
    This is because the impact points always records the maximum amplitude of a acoustic wave front, thus the mean value may be larger than at the y-z center.
    x = \SI{-0.08}{\meter} is in the near-field (or Fresnel) zone thus the difference of maximum pressure value and on-axis pressure (i.e. pressure at the center of y-z plane) is large.

    4. shows standard deviations divided by mean values at each z altitude.
    At the altitude between z = \SIrange{0.10}{0.15}{\meter}, the standard deviations at each x position becomes larger than the other altitudes.

    By applying moving average with length of window = 8 and with triangle window, we obtained the figure 5.
    The scatter plots are the std/mean values before smoothing and lines are smoothed curves.
    The curves have similar peak positions with CTFI curves (Figure \ref{fig:ctfi_1d}) and from the 2nd derivatives of them (6.) shows the same positions of inflection points with CTFI curves.
    Thus, the inflection points of std/mean curves of maximum amplitudes are occurred at the altitudes of merging point and combining point of TFI values.


\begin{figure}[htbp]
    \centerline{\includegraphics[width=18.0cm]{std_amps_v3.png}}
    \slantedcaption{
    1: Comparison of maximum magnitude at center of each y-z receiving plane.
    2: Comparison of maximum magnitude at acoustic impact point (i.e. where the pressure value becomes maximum on each y-z plane).
    3: Comparison of mean value of maximum amplitudes. Solid lines are the values at y-z center and break lines are values at impact points.
    4: Comparison of standard deviation values divided by mean value of each z altitude. 
    5: Smoothed std/mean curves by moving average.
    6: 2nd order derivatives of smoothed std/mean curves.}
    \label{fig:std_amps}
\end{figure}

    Figure \ref{fig:std_r} is the analysis about the deviation length r.
    1. indicates mean curves with solid lines and 2. shows standard deviation curves.
    The peak positions are also similar with the maximum amplitude curves i.e. the peaks of the x = \SIlist{0.035;0.08;0.105}{\meter} curves comes around z altitude = \SIrange{0.13}{0.14}{\meter}.
    The curves on 3. are smoothed mean curves, and 4. shows the 2nd order derivatives of these means.
    On 5. and 6. are smoothed standard deviations and their derivatives.
    From 4. and 6., we could also find the inflection points for mean and standard deviation curves at the merging point and combining point of TFI.

\begin{figure}[htbp]
    \centerline{\includegraphics[width=18.0cm]{std_r_v3.png}}
    \slantedcaption{
    1: Comparison mean and standard deviatn of deviation length r. The solid line is mean value and the break line is mean + standard deviation.
    2: Only standard deviation comparison.
    3: Smoothed mean curves with moving average.
    4: 2nd order derivatives of smooothed mean lines.
    5: Smoothed standard deviation curves with moving average.
    6: 2nd order derivatives of smooothed standard deviation lines.}
    \label{fig:std_r}
\end{figure}

    Figure \ref{fig:std_theta} shows the mean and standard deviations of $theta$ as defined in Figure \ref{fig:impactpoint}. 
    Solid lines are mean angles and break lins are mean + standard deviation and mean - standard deviations.
    In the altitude lower than \SI{0.15}{\meter}, the mean angle is shifted in the first quadrant.
    Thus in these region, the deflection of acoustic beams have directivity.
    At altitudes higher than \SI{0.15}{\meter}, the mean angle is still shifted but from the deviation length r, which has smaller values at these high altitudes as seen in Figure \ref{fig:std_r}, the directivity of deflection is no more existing.
    From this result, we found that the directivity of the deflection effect on acoustic propagation exists at lower altitude, where the sodium flow is still strong and mixing between jets are no matured.
    That is, the isotropic Gaussian random field is not applicable for this area because isotropic Gaussian field creates has no directive effect on wave propagation.
    This altitude \SI{0.15} was the position where CTFI curves for x = \SI{0.105}{\meter} comes maximum.

\begin{figure}[htbp]
    \centerline{\includegraphics[width=10.0cm]{std_theta_v2.png}}
    \slantedcaption{Comparison of standard deviation and mean values of deviation angle theta.}
    \label{fig:std_theta}
\end{figure}

    Finally, we analyse the simulation results based on the fluctuation of time of flights (i.e. receiving time of a signal).
    We defined the receiving time as the peak position of envelop curve of a signal (Figure \ref{fig:def_tof} break line position).
    
    Figures in \ref{fig:std_tof} shows the change of mean and standard deviation of time of flights at each z altitude of each x position. In the figure x = \SI{-0.105}{\meter}, almost no fluctuation of time of flight is find except the altitudes \SIrange{0.18}{0.22}{\meter}.
    As one can see in the TFI field (Figure \ref{fig:tfi_with_field}), even the x position is before the first jet, the fluctuation of medium is occurred because the fluctuating field diffuses when the flows go higher.% \parencite{Durve2010Thermalstripingin}.

    At x = \SI{-0.08}{\meter}, this character of mixing jet may be confirmed from the altitudes where time of flight values is fluctuating becomes wider and a little lower than x = \SI{-0.105}{\meter}.
    Then at x = \SI{-0.035}{\meter}, the standard deviation curve become wider with its peak position at about z = \SI{0.16}{\meter}, while the mean curve comes its peak at lower altitude at \SI{0.08}{\meter}.
    This peak position of mean time of flight was caused by the difference of mean temperature from acoustic source to receiving point among each altitude.

    Figure \ref{fig:mean_profile} 1. 2. shows the transition of mean temperature from acoustic source to receiving point.
    3. 4. shows the mean sound speed profiles.
    From 3. it is clearly seen that around x = \SI{-0.035}{\meter}, the mean sound speed becomes low especially when the altitude is low. This is why mean time of flight at x = \SI{-0.035}{\meter} has larger time of flight values at lower altitudes.

    On the other hand, around x = \SI{0.035}{\meter}, mean sound speed becomes higher when the altitude is low and this causes the faster arrival of mean time of flight.

    Figure \ref{fig:std_tof2} shows the 2nd order derivatives calculated from mean values (left) and standard deviations (right) of time of flight.
    Moving average is also applied for both mean and standard derivative curves to obtain the 2nd order derivatives.
    As the other derivative curves, i.e. maximum amplitude and r, those curves also has two inflection points with those inflection points at near to the merging point and combining point.

\begin{figure}[htbp]
    \centerline{\includegraphics[width=12.0cm]{tof_def.png}}
    \slantedcaption{Definition of time of flight (receiving time).}
    \label{fig:def_tof}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=18.0cm]{std_tof_v2.png}}
    \slantedcaption{Comparison of standard deviation (magenta) and mean (navy) values of receiving time. the range of holizontal axis of each figure is same on both mean and standard deviation.}
    \label{fig:std_tof}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=18.0cm]{cmeantemp_1d.png}}
    \slantedcaption{
1: mean temperatures from source to receiver.
2: mean temperatures from source to receiver depending on z.
3: mean sound spead.
4: mean sound spead depending on z.
}
    \label{fig:mean_profile}
\end{figure}

\begin{figure}[htbp]
    \centerline{\includegraphics[width=16.0cm]{std_tof2.png}}
    \slantedcaption{2nd derivatives mean (left) and standard deviation (right) of time of flight.}
    \label{fig:std_tof2}
\end{figure}


\section{conclusions}
    In this chapter, we studied the effect of realistic heterogeneous temperature field on wave propagation.
    At first we tried to calculate wave propagation at a single moment of CFD changing the altitude of insonified zone in order to find the amount of effect of the sodium state in PLAJEST on a propagation.

    As the second step, we carried out the same acoustic simulation for multiple CFD time steps.

        
    From this results, we found that at the low altitude where the mixing of flows is not enough matured, the temperature heterogeneity may cause directive fluctuation of acoustic propagation.
    This means that, as the simulation method of fluctuation field for acoustics, application of isotropic Gaussian Random Field may not take into account the directive response of fluctuation of acoustic signals.
    
    We also found the relations between maturing state of temperature fluctuation intensity (TFI) depending on the altitude i.e. distance from the sodium outlet to propagating area.
    We found that the merging point (where the two high TFI zones between each of three jets start to merge) and combining point of TFI (where the merging of TFI zones is completed).


% mention here about the GRF generation software which Dimitri's collegue developed


